<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Logout - Omada WiFi</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            text-align: center;
            margin: 50px;
        }
        .container {
            max-width: 500px;
            margin: auto;
            padding: 20px;
            border: 1px solid #ddd;
            border-radius: 10px;
            box-shadow: 2px 2px 10px rgba(0,0,0,0.1);
        }
        button {
            background-color: #FF3B30;
            color: white;
            padding: 10px 20px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            margin-top: 20px;
        }
        button:hover {
            background-color: #D32F2F;
        }
    </style>
</head>
<body>
    <div class="container">
        <h2>Session Details</h2>
        <p><strong>Session Start Time:</strong> <span id="startTime">Loading...</span></p>
        <p><strong>Active Session Duration:</strong> <span id="sessionDuration">00:00:00</span></p>
        <button onclick="logout()">Logout</button>
    </div>

    <script>
        // Get stored session data
        let startTime = localStorage.getItem("sessionStartTime");
        let activeTime = parseInt(localStorage.getItem("activeSessionTime")) || 0;
        let lastActive = localStorage.getItem("lastActive");

        // If session doesn't exist, start now
        if (!startTime) {
            startTime = new Date().toISOString();
            localStorage.setItem("sessionStartTime", startTime);
        }

        // Convert start time to Date object
        let startDate = new Date(startTime);
        document.getElementById("startTime").innerText = startDate.toLocaleTimeString();

        let tracking = false;
        let interval;

        // Function to update session duration
        function updateSessionDuration() {
            let duration = activeTime; // Start with previously stored active time

            if (tracking) {
                let now = new Date();
                let lastActiveDate = lastActive ? new Date(lastActive) : now;
                duration += Math.floor((now - lastActiveDate) / 1000); // Add new active time
            }

            let hours = Math.floor(duration / 3600);
            let minutes = Math.floor((duration % 3600) / 60);
            let seconds = duration % 60;

            document.getElementById("sessionDuration").innerText =
                `${hours.toString().padStart(2, '0')}:${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;
        }

        // Start tracking when page is active
        function startTracking() {
            if (!tracking) {
                tracking = true;
                lastActive = new Date().toISOString();
                localStorage.setItem("lastActive", lastActive);
            }
        }

        // Stop tracking when page is inactive
        function stopTracking() {
            if (tracking) {
                tracking = false;
                let now = new Date();
                let lastActiveDate = new Date(lastActive);
                activeTime += Math.floor((now - lastActiveDate) / 1000);
                localStorage.setItem("activeSessionTime", activeTime);
            }
        }

        // Listen for page visibility changes
        document.addEventListener("visibilitychange", () => {
            if (document.visibilityState === "visible") {
                startTracking();
            } else {
                stopTracking();
            }
        });

        // Start tracking on load
        window.onload = function () {
            startTracking();
            interval = setInterval(updateSessionDuration, 1000);
        };

        // Logout function (clears session data)
        function logout() {
            localStorage.removeItem("sessionStartTime");
            localStorage.removeItem("activeSessionTime");
            localStorage.removeItem("lastActive");
            window.location.href = "http://portal.tplink.net/portal/logout"; // Omada logout
        }
    </script>
</body>
</html>
